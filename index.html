<!DOCTYPE html>
<meta charset="utf-8" />
<div>
  <textarea class="text" style="height: 4em; width: 80em;" autofocus></textarea>
</div>
<div><input class="progress" /></div>
<div class="candidate"></div>
<script>
  function codeToStr(i) {
    if (i === 0x09) return "[Tab]";
    if (i === 0x0a) return "[Enter]";
    if (i === 0x20) return "[Space]";
    if (i < 0x20 || 0x7f <= i) return "";
    return String.fromCodePoint(i);
  }
  function updateCandidates(codeStart, codeLen) {
    let html = '<table style="font-family: monospace;">';
    const rowCodeLen = codeLen / 4;
    for (let i = 0; i < 4; ++i) {
      const rowCodeStart = codeStart + rowCodeLen * i;
      html += "<tr>";
      html += `<td>${"↑←→↓"[i]}</td>`
      html += `<td>0x${rowCodeStart.toString(16).padStart(2, "0")}</td>`;
      html += "<td>";
      for (let j = 0; j < rowCodeLen; ++j) {
        const code = rowCodeStart + j;
        html += codeToStr(code);
      }
      html += "</td>";
      html += "</tr>";
    }
    html += "</table>";
    document.querySelector(".candidate").innerHTML = html;
  }
  function updateProgress(code2bs) {
    const progress = code2bs.reduce((a, c) => a + "↑←→↓"[c], "");
    document.querySelector(".progress").value = progress;
  }
  let code2bs = [];
  function onKeyDown(e) {
    const arrowKeys = ["ArrowUp", "ArrowLeft", "ArrowRight", "ArrowDown"];
    const idx = arrowKeys.indexOf(e.key);
    if (idx >= 0) {
      code2bs.push(idx);
      e.preventDefault();
    }
    if (e.key === "Escape") {
      code2bs.pop();
      e.preventDefault();
    }
    updateProgress(code2bs);
    let code = code2bs.reduce((a, c, i) => a + (c << (2 * (3 - i))), 0);
    if (code2bs.length === 4) {
      document.querySelector(".text").value += String.fromCodePoint(code);
      code = 0;
      code2bs = [];
    }
    updateCandidates(code, 256 / (1 << (code2bs.length * 2)));
  }
  onload = () => {
    updateCandidates(0, 256);
    document.querySelector(".text").onkeydown = e => onKeyDown(e);
  };
</script>
